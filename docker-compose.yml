services:
  pgrokd:
    image: "ghcr.io/pgrok/pgrokd:latest"
    restart: always
    ports:
      - "2222:2222"
    depends_on:
      - postgres
    networks:
      - dokploy-network
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        echo "=== ls /app ==="
        ls -la /app/ 2>/dev/null || echo "no /app"
        echo "=== ls /usr/bin ==="
        ls /usr/bin/ 2>/dev/null
        echo "=== ls /bin ==="
        ls /bin/ 2>/dev/null
        echo "=== ls / ==="
        ls -la /
        echo "=== entrypoint ==="
        cat /entrypoint.sh 2>/dev/null || echo "no entrypoint"
        cat /Dockerfile 2>/dev/null || echo "no dockerfile"
        sleep 3600
  postgres:
    image: postgres
    restart: always
    volumes:
      - "pg_data:/var/lib/postgresql/data"
    environment:
      POSTGRES_DB: pgrokd
      POSTGRES_USER: "${POSTGRES_USER}"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
    networks:
      - dokploy-network
volumes:
  pg_data:
networks:
  dokploy-network:
    external: true
