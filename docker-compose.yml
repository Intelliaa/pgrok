services:
  pgrokd:
    image: "ghcr.io/pgrok/pgrokd:latest"
    restart: always
    ports:
      - "2222:2222"
    depends_on:
      - postgres
    networks:
      - dokploy-network
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        echo "=== /home ==="
        ls -laR /home/
        echo "=== /sbin ==="
        ls /sbin/
        echo "=== /usr/local/bin ==="
        ls /usr/local/bin/ 2>/dev/null
        echo "=== /usr/bin ==="
        ls /usr/bin/
        echo "=== find pgrok ==="
        find / -name "*pgrok*" 2>/dev/null
        sleep 3600
  postgres:
    image: postgres
    restart: always
    volumes:
      - "pg_data:/var/lib/postgresql/data"
    environment:
      POSTGRES_DB: pgrokd
      POSTGRES_USER: "${POSTGRES_USER}"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
    networks:
      - dokploy-network
volumes:
  pg_data:
networks:
  dokploy-network:
    external: true
